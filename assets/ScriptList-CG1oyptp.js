import{r as l,j as s,b as z,n as v,g as A,s as O,L as J,F as M}from"./index-DmGc86nm.js";import{c as x,S as b,a as R,H as P}from"./Header-DrlQD36Y.js";import{C as U,f as $,a as E}from"./fetchJson-DT2TUCxi.js";import{n as w}from"./urls-Da3-BjU2.js";import{u as F}from"./useAsyncData-WfHgw-sD.js";const H=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],B=x("book-open",H);const V=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],N=x("check",V);const W=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Y=x("chevron-up",W);const q=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],G=x("copy",q);const K=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],S=x("download",K);const Q=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],X=x("file-text",Q);const Z=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],ee=x("share-2",Z),se=e=>{const a=e.reduce((t,o)=>(o.official?t.official.push(o):o.teensyville?t.teensyville.push(o):t.community.push(o),t),{official:[],community:[],teensyville:[]});return[{id:b.OFFICIAL,title:"공식 스크립트",scripts:a.official},{id:b.COMMUNITY,title:"커스텀 스크립트",scripts:a.community},{id:b.TEENSYVILLE,title:"틴시빌 스크립트",scripts:a.teensyville}]},_=e=>{const[a,t]=l.useState(null),o=l.useRef(null),n=l.useCallback(()=>{o.current!==null&&(window.clearTimeout(o.current),o.current=null)},[]),c=l.useCallback(()=>{n(),t(null)},[n]),m=l.useCallback(r=>{t(r),n(),o.current=window.setTimeout(()=>{t(p=>p===r?null:p),o.current=null},e)},[n,e]);return l.useEffect(()=>c,[c]),{value:a,show:m,clear:c}},I=()=>typeof navigator<"u"&&typeof navigator.clipboard?.writeText=="function",L=async e=>{if(!I())throw new Error("Clipboard API is not available");await navigator.clipboard.writeText(e)},te="inline-flex items-center justify-center gap-1 px-3 sm:px-4 py-2 text-sm sm:text-base rounded-lg shadow-xs transition-all duration-200 font-medium",oe=2e3,u=({className:e,onClick:a,disabled:t=!1,icon:o,label:n})=>s.jsxs("button",{type:"button",onClick:a,disabled:t,className:`${te} ${e}`,children:[o,s.jsx("span",{className:"whitespace-nowrap",children:n})]}),ae=({script:e,onCopyJson:a,onDownloadJson:t,onDownloadPdf:o,copiedId:n,downloadingId:c})=>{const m=I(),{value:r,show:p}=_(oe),d=async()=>{try{const g=z(e.id);await L(g),p(!0)}catch(g){console.error("Failed to copy URL:",g),v("공유 링크 복사 중 오류가 발생했습니다.",!1)}},i=n===e.id,h=c===e.id,y=r===!0;return s.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[m&&s.jsx(u,{onClick:()=>a(e.json,e.id),className:`${i?"bg-gradient-to-r from-emerald-500 to-teal-500":"bg-gradient-to-r from-teal-500 to-emerald-500"} text-white hover:from-teal-600 hover:to-emerald-600 hover:shadow-md active:scale-95`,icon:i?s.jsx(N,{size:16,className:"shrink-0"}):s.jsx(G,{size:16,className:"shrink-0"}),label:i?"복사됨":"복사"}),s.jsx(u,{onClick:()=>o(e.pdf,e.id),disabled:h,className:"bg-gradient-to-r from-rose-500 to-pink-500 text-white hover:from-rose-600 hover:to-pink-600 hover:shadow-md active:scale-95 disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:shadow-none disabled:active:scale-100",icon:h?void 0:s.jsx(S,{size:16,className:"shrink-0"}),label:h?"다운로드 중...":"시트"}),s.jsx(u,{onClick:()=>t(e.json,e.id),className:"bg-gradient-to-r from-indigo-500 to-blue-500 text-white hover:from-indigo-600 hover:to-blue-600 hover:shadow-md active:scale-95",icon:s.jsx(S,{size:16,className:"shrink-0"}),label:"JSON"}),s.jsx(u,{onClick:()=>{d()},disabled:!m,className:`${y?"bg-gradient-to-r from-emerald-500 to-teal-500":"bg-gradient-to-r from-violet-500 to-purple-500"} text-white hover:from-violet-600 hover:to-purple-600 hover:shadow-md active:scale-95 disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:shadow-none disabled:active:scale-100`,icon:y?s.jsx(N,{size:16,className:"shrink-0"}):s.jsx(ee,{size:16,className:"shrink-0"}),label:y?"복사됨":"공유"})]})},ne="/assets/bad_moon_rising-BG84x0Jl.png",f="/assets/blood_on_the_clocktower-B6PzmeIe.png",ie="/assets/sects_and_violets-CwlD2QA-.png",le="/assets/trouble_brewing-C5NHKrJx.png",k={tb:le,bmr:ne,snv:ie};function ce({src:e,alt:a}){const[t,o]=l.useState(k[e]||e||f),n=()=>{t!==f&&o(f)};return l.useEffect(()=>{o(k[e]||e||f)},[e]),s.jsx("img",{src:t,alt:a,onError:n,className:"w-24 h-24 sm:w-32 sm:h-32 object-contain"})}const re="이 스크립트에 대한 설명이 곧 추가될 예정입니다.",C=({isExpanded:e,onToggle:a,icon:t,title:o,content:n,defaultExpanded:c=!1})=>s.jsxs("div",{className:`w-full ${c?"sm:hidden":""}`,children:[s.jsxs("button",{type:"button",onClick:a,className:"w-full mt-2 p-2 bg-gray-50 rounded-md flex items-center justify-between text-gray-600 hover:bg-gray-100 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(t,{size:16}),s.jsx("span",{className:"text-sm",children:o})]}),e?s.jsx(Y,{size:16}):s.jsx(U,{size:16})]}),e?s.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded-md",children:s.jsx("div",{className:"whitespace-pre-line text-sm text-gray-600",children:n})}):null]}),de=({synopsis:e})=>s.jsx("div",{className:"hidden sm:block text-gray-600 text-sm sm:text-base whitespace-pre-line",children:e}),me=({script:e,onCopyJson:a,onDownloadJson:t,onDownloadPdf:o,copiedId:n,downloadingId:c})=>{const[m,r]=l.useState(!1),[p,d]=l.useState(!1),i=e.synopsis||re;return s.jsx("div",{id:e.id,className:"bg-white rounded-lg shadow-lg overflow-hidden",children:s.jsx("div",{className:"p-4 sm:p-6",children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-4 sm:gap-6",children:[s.jsx(ce,{src:e.logo,alt:e.name}),s.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[s.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-3",children:s.jsxs("div",{className:"flex items-center justify-center sm:justify-start gap-2 flex-wrap",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold",children:e.name}),e.teensyville&&s.jsx("span",{className:"inline-flex w-fit shrink-0 items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:"틴시빌"}),e.author&&s.jsxs("span",{className:"text-gray-600 text-sm sm:text-base",children:["by ",e.author]})]})}),s.jsx(de,{synopsis:i}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(C,{isExpanded:p,onToggle:()=>d(h=>!h),icon:X,title:"개요",content:i,defaultExpanded:!0}),e.note&&s.jsx(C,{isExpanded:m,onToggle:()=>r(h=>!h),icon:B,title:"번역 노트",content:e.note})]}),s.jsx("div",{className:"flex justify-center sm:justify-start gap-2 mt-4",children:s.jsx(ae,{script:e,onCopyJson:a,onDownloadJson:t,onDownloadPdf:o,copiedId:n,downloadingId:c})})]})]})})})},he=({title:e,scripts:a,onCopyJson:t,onDownloadJson:o,onDownloadPdf:n,copiedId:c,downloadingId:m})=>s.jsxs("div",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-6 border-b pb-2",children:e}),s.jsx("div",{className:"grid gap-6 sm:gap-8",children:a.map(r=>s.jsx(me,{script:r,onCopyJson:t,onDownloadJson:o,onDownloadPdf:n,copiedId:c,downloadingId:m},r.id))})]}),pe=e=>{l.useEffect(()=>{const a=()=>{const t=A();!t||!e||O(t,R)};return a(),window.addEventListener("hashchange",a),()=>window.removeEventListener("hashchange",a)},[e])},T=(e,a)=>{const t=URL.createObjectURL(e),o=document.createElement("a");o.href=t,o.download=a,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t)},xe=async e=>(await E("/scripts.json",{signal:e})).map(t=>({...t,json:w(t.json),pdf:w(t.pdf),logo:typeof t.logo=="string"?w(t.logo):""})),ue=async e=>{await L(await D(e))},fe=async(e,a)=>{const t=new Blob([await D(e)],{type:"application/json"});T(t,`${a}.json`)},ye=async e=>{const t=await(await $(e)).blob(),o=e.split("/").pop()??"script.pdf";T(t,o)},D=async e=>{const a=await E(e);return JSON.stringify(a,null,2)},ge=1e3,j=async(e,a,t)=>{try{return await e(),!0}catch(o){return console.error(`Error during ${a}:`,o),v(t),!1}},be=()=>{const{value:e,show:a,clear:t}=_(ge),[o,n]=l.useState(null),c=l.useCallback(d=>{a(d)},[a]),m=l.useCallback(async(d,i)=>{await j(async()=>{await ue(d),c(i)},"copying JSON","JSON 복사 중 오류가 발생했습니다.")||t()},[t,c]),r=l.useCallback(async(d,i)=>{await j(()=>fe(d,i),"downloading JSON","JSON 다운로드 중 오류가 발생했습니다.")},[]),p=l.useCallback(async(d,i)=>{n(i);try{await j(()=>ye(d),"downloading PDF","PDF 다운로드 중 오류가 발생했습니다.")}finally{n(h=>h===i?null:h)}},[]);return{copiedId:e,downloadingId:o,onCopyJson:m,onDownloadJson:r,onDownloadPdf:p}},we=()=>{const e=l.useCallback(o=>{console.error("Error loading scripts:",o),v("스크립트 데이터를 불러오지 못했습니다.")},[]),{data:a,isLoading:t}=F(xe,[],{onError:e});return{scripts:a,isLoading:t}},Ce=({currentPage:e,onPageChange:a})=>{const{scripts:t,isLoading:o}=we(),{copiedId:n,downloadingId:c,onCopyJson:m,onDownloadJson:r,onDownloadPdf:p}=be();pe(!o&&t.length>0);const d=l.useMemo(()=>se(t),[t]);return o?s.jsx(J,{className:"min-h-screen"}):s.jsxs(s.Fragment,{children:[s.jsx(P,{currentPage:e,onPageChange:a}),s.jsx("div",{className:"max-w-6xl mx-auto p-4 sm:p-6",children:d.filter(i=>i.scripts.length>0).map(i=>s.jsx("div",{id:i.id,children:s.jsx(he,{title:i.title,scripts:i.scripts,onCopyJson:m,onDownloadJson:r,onDownloadPdf:p,copiedId:n,downloadingId:c})},i.id))}),s.jsx(M,{})]})};export{Ce as default};
